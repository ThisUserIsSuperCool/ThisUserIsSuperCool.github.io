<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.11.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="起名字已经很难了为什么还要给blog起个title">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="起名字已经很难了为什么还要给blog起个title">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="有聊人士">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>起名字已经很难了为什么还要给blog起个title</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">起名字已经很难了为什么还要给blog起个title</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">有聊人士</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">9</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/13/%E5%B8%B8%E7%94%A8%E9%80%9F%E6%9F%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="有聊人士">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="起名字已经很难了为什么还要给blog起个title">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 起名字已经很难了为什么还要给blog起个title">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/13/%E5%B8%B8%E7%94%A8%E9%80%9F%E6%9F%A5/" class="post-title-link" itemprop="url">常用速查</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-04-13 16:05:23 / Modified: 16:11:39" itemprop="dateCreated datePublished" datetime="2022-04-13T16:05:23+08:00">2022-04-13</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1-hero"><a href="#1-hero" class="headerlink" title="1 hero"></a>1 hero</h2><p>(1) Front-matter</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">title: &#123;&#123; title &#125;&#125;</span><br><span class="line">permalink: &#123;&#123; title &#125;&#125;</span><br><span class="line">date: &#123;&#123; date &#125;&#125;</span><br><span class="line">tags:</span><br><span class="line"><span class="bullet">-</span> a</span><br><span class="line"><span class="bullet">-</span> b</span><br><span class="line">categories:</span><br><span class="line"><span class="bullet">-</span> c</span><br><span class="line">password: hello</span><br><span class="line">top: 1</span><br></pre></td></tr></table></figure>

<p>(2) deploy</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo g -d</span><br></pre></td></tr></table></figure>

<p>(3)已有cat &amp; tag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat: tool tricks python attention </span><br><span class="line">tag: 调参 ticks hexo translation 李宏毅 规范 top</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/13/hexo-%E6%96%87%E7%AB%A0%E5%8A%A0%E5%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="有聊人士">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="起名字已经很难了为什么还要给blog起个title">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 起名字已经很难了为什么还要给blog起个title">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/13/hexo-%E6%96%87%E7%AB%A0%E5%8A%A0%E5%AF%86/" class="post-title-link" itemprop="url">hero blog加密/置顶</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-04-13 15:54:04 / Modified: 16:02:38" itemprop="dateCreated datePublished" datetime="2022-04-13T15:54:04+08:00">2022-04-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/tool/" itemprop="url" rel="index"><span itemprop="name">tool</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>参照以下blog：</p>
<p><a target="_blank" rel="noopener" href="https://www.itfanr.cc/2021/04/16/hexo-blog-article-encryption/">https://www.itfanr.cc/2021/04/16/hexo-blog-article-encryption/</a></p>
<p>官网：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/D0n9X1n/hexo-blog-encrypt">https://github.com/D0n9X1n/hexo-blog-encrypt</a></p>
<h2 id="1-hexo-blog-encrypt对blog加密"><a href="#1-hexo-blog-encrypt对blog加密" class="headerlink" title="1 hexo-blog-encrypt对blog加密"></a>1 hexo-blog-encrypt对blog加密</h2><h4 id="定向单篇文章加密："><a href="#定向单篇文章加密：" class="headerlink" title="定向单篇文章加密："></a>定向单篇文章加密：</h4><p>使用<code>hexo-blog-encrypt</code>， 在<code>Front-matter</code>中添加password即可。</p>
<ol>
<li><p>安装<code>hexo-blog-encrypt</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save hexo-blog-encrypt</span><br></pre></td></tr></table></figure>
</li>
<li><p>在文章信息头部添加 <code>password</code> 字段</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: Hello World</span><br><span class="line">date: 2022-04-13 15:48:57</span><br><span class="line"><span class="section">password: hello</span></span><br><span class="line"><span class="section">---</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>清除缓存后生成并部署</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo s -g</span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="2-hexo-generator-topindex对blog置顶"><a href="#2-hexo-generator-topindex对blog置顶" class="headerlink" title="2 hexo-generator-topindex对blog置顶"></a>2 hexo-generator-topindex对blog置顶</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/COCO56/article/details/103840966">https://blog.csdn.net/COCO56/article/details/103840966</a></p>
<p>同理：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-generator-topindex --save</span><br></pre></td></tr></table></figure>

<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 置顶</span><br><span class="line">date: 2022-04-13 15:59:52</span><br><span class="line"><span class="section">top: 1</span></span><br><span class="line"><span class="section">---</span></span><br></pre></td></tr></table></figure>

<p>如果存在多个置顶文章，top后的参数越大，越靠前。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/11/2022-04-11-%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E7%9A%84%E8%AE%BE%E8%AE%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="有聊人士">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="起名字已经很难了为什么还要给blog起个title">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 起名字已经很难了为什么还要给blog起个title">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/11/2022-04-11-%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E7%9A%84%E8%AE%BE%E8%AE%A1/" class="post-title-link" itemprop="url">神经网络的设计</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-04-11 11:44:16 / Modified: 21:49:24" itemprop="dateCreated datePublished" datetime="2022-04-11T11:44:16+08:00">2022-04-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/tricks/" itemprop="url" rel="index"><span itemprop="name">tricks</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://pcc.cs.byu.edu/2017/10/02/practical-advice-for-building-deep-neural-networks/">Practical Advice for Building Deep Neural Networks</a> &amp; <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/44461454">trans_version</a></p>
<p>(1) Design</p>
<ul>
<li>使用 ADAM 优化器</li>
<li>ReLU 是最好的非线性(激活函数)</li>
<li>不要在output layer使用activation function</li>
<li>请在每一个层添加一个bias</li>
<li>使用方差缩放（variance-scaled）初始化</li>
<li>归一化输入数据</li>
<li>一般不用学习率衰减: 学习率衰减在 SGD 中更为常见，但 ADAM 很自然地处理了这个问题。</li>
<li>如果你的卷积层有 64 或 128 个过滤器，那就足够了。特别是一个对于深度网络而言。比如，128 个真的就已经很多了。如果你已经有了大量的过滤器，那么再添加更多的过滤器未必会进一步提高性能。</li>
<li>池化用于平移不变性</li>
</ul>
<p>(2) 如果你的网络没能很好地进行学习（指在训练过程中损失&#x2F;准确率没有收敛，或者没有得到预期的结果）</p>
<ul>
<li>过拟合：The first thing to do if your network isn’t learning is to overfit a training point. </li>
<li>提高&#x2F;降低学习率</li>
<li>减小batch_size</li>
<li>增加&#x2F;删除批归一化层</li>
<li><strong>Check your reshaping.</strong> Drastic reshaping (like changing an image’s X,Y dimensions) can destroy spatial locality, making it harder for a network to learn since it must also learn the reshape. (Natural features become fragmented. The fact that natural features appear spatially local is why conv nets are so effective!) Be especially careful if reshaping with multiple images&#x2F;channels; use <code>numpy.stack()</code> for proper alignment.</li>
<li>损失函数：如果使用一个复杂的函数，请尝试将其简化为 L1 或 L2。我们发现L1对异常值不那么敏感，在发出噪声的批或训练点时，不会做出太大的调整。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/09/%E5%90%84%E7%A7%8D%E5%90%84%E6%A0%B7%E7%9A%84attention/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="有聊人士">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="起名字已经很难了为什么还要给blog起个title">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 起名字已经很难了为什么还要给blog起个title">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/09/%E5%90%84%E7%A7%8D%E5%90%84%E6%A0%B7%E7%9A%84attention/" class="post-title-link" itemprop="url">attn 的各式变体</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-04-09 18:03:08 / Modified: 18:03:15" itemprop="dateCreated datePublished" datetime="2022-04-09T18:03:08+08:00">2022-04-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/attention/" itemprop="url" rel="index"><span itemprop="name">attention</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=yHoAq1IT_og&t=18s">video</a>; <a target="_blank" rel="noopener" href="https://speech.ee.ntu.edu.tw/~hylee/ml/2022-spring.php">machine learning</a>; <a target="_blank" rel="noopener" href="https://speech.ee.ntu.edu.tw/~hylee/ml/ml2022-course-data/xformer%20(v8).pdf">ppt</a></p>
<p><strong>attn 的各式变体，<u>目的：减小运算量。</u></strong></p>
<h2 id="1-人为选择的attention-map"><a href="#1-人为选择的attention-map" class="headerlink" title="1 人为选择的attention map"></a>1 人为选择的attention map</h2><p>full attn 计算量很大，只计算局部 attn 有利于减少参数量。<u>几种人为设定的attn如下：</u></p>
<ul>
<li><p>local attn&#x2F;truncated attn，只计算相邻的 attn，类似于cnn。</p>
<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h10yx33y0hj209m090q3j.jpg" style="zoom:50%;" />
</li>
<li><p>Stride attn，计算相邻s步的attn。</p>
<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h10yylrk64j20g00fuglx.jpg" style="zoom:28%;" />
</li>
<li><p>global attn，计算与special token有关的attn，将special token看作所有位置信息的交互站。</p>
<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h10yzumgyoj20m80n0409.jpg" style="zoom:20%;" />
</li>
<li><p>Random attn</p>
<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h10z1cm308j20ag0acaa5.jpg" style="zoom:45%;" /></li>
</ul>
<p>哪个好？都要。<u>不同的head做不同的 attn</u>。Longformer; Big Bird</p>
<h2 id="2-用Clustering选择需要计算的attention位置：Reformer-和-Routing-Transformer"><a href="#2-用Clustering选择需要计算的attention位置：Reformer-和-Routing-Transformer" class="headerlink" title="2 用Clustering选择需要计算的attention位置：Reformer 和 Routing Transformer"></a>2 用Clustering选择需要计算的attention位置：Reformer 和 Routing Transformer</h2><p><strong>以上的attn都是人为设定的，是否可以由机器决定位置是否需要计算attn？</strong></p>
<p>在attn map上，权重大的地方，说明二者之间的关系更重要，希望将权重低的地方直接设为0（不计算）。问题是：如何估计值小的位置呢？</p>
<p>Reformer 和 Routing Transformer提到了Clustering的方法。</p>
<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h10zur5726j20jk0aidgt.jpg" style="zoom:65%;" />

<p><u>只计算同一个cluster里的vector之间的attn。</u></p>
<h2 id="3-直接learn出attention-map：Sinkhorn-sorting-network"><a href="#3-直接learn出attention-map：Sinkhorn-sorting-network" class="headerlink" title="3 直接learn出attention map：Sinkhorn sorting network"></a>3 直接learn出attention map：Sinkhorn sorting network</h2><p>还有更自动化的方式。</p>
<p>Sinkhorn sorting network：对input学习出一个低维矩阵，这个矩阵通过线性变换可以和某些运算可以生成一个和attn大小一致的0-1矩阵，以此控制0的位置的矩阵不进行运算。(<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2002.11296.pdf">https://arxiv.org/pdf/2002.11296.pdf</a>)</p>
<img src="https://pic4.zhimg.com/80/v2-5821c8e5fed43a3ff23bc5f2d7d5a41b_1440w.jpg" style="zoom:50%;" />

<h2 id="4-选出有代表性的columns：Linformer和Compressed-Attention"><a href="#4-选出有代表性的columns：Linformer和Compressed-Attention" class="headerlink" title="4 选出有代表性的columns：Linformer和Compressed Attention"></a>4 选出有代表性的columns：Linformer和Compressed Attention</h2><p>Linformer 中提出我们并不需要那么多attn：Many redundant columns！！！</p>
<p>建议：提取出一些具有代表性的key而不是全部。</p>
<img src="https://pic3.zhimg.com/80/v2-c962f0709eb82642f56c5526ad7113ca_1440w.jpg" style="zoom:50%;" />

<p>注意到对于非 seq2seq 问题，可以考虑也提取出一些具有代表性的query。</p>
<p>无论 query 还是 key，如何挑选出有代表性的columns呢？</p>
<ul>
<li>Linformer（<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2006.04768.pdf%EF%BC%89">https://arxiv.org/pdf/2006.04768.pdf）</a></li>
<li>Compressed Attention（<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1801.10198.pdf%EF%BC%89">https://arxiv.org/pdf/1801.10198.pdf）</a></li>
</ul>
<img src="https://pic1.zhimg.com/80/v2-d1b1eab50c9485ffae3d384ae022919c_1440w.jpg" style="zoom:50%;" />

<h2 id="5-改变矩阵顺序可以减少运算量"><a href="#5-改变矩阵顺序可以减少运算量" class="headerlink" title="5 改变矩阵顺序可以减少运算量"></a>5 改变矩阵顺序可以减少运算量</h2><p>对于$O&#x3D;VK^TQ$, </p>
<p>其中：$V(d’,N),K^T(N,d),Q(d,N)$</p>
<ul>
<li>$O&#x3D;V(K^TQ)$：运算量为: $(N\times d \times N)+(d’ \times N \times N)&#x3D;(d+d’)N^2$</li>
<li>$O&#x3D;(VK^T)Q$：运算量为: $(d’ \times N \times d)+(d’ \times d \times N)&#x3D;2d’dN$</li>
</ul>
<h4 id="加上softmax进行考虑"><a href="#加上softmax进行考虑" class="headerlink" title="加上softmax进行考虑"></a>加上softmax进行考虑</h4><p>对于原来（$b^1&#x3D;\sum_{i&#x3D;1}^{N} \alpha’<em>{1,i}v^i&#x3D;\sum</em>{i&#x3D;1}^{N}\frac{exp(q^1\cdot k^i)}{\sum_{j&#x3D;1}^{N}exp(q^1\cdot k^j)}v^i $）,设有一个函数$\phi()$，能使$exp(q\cdot k)\approx \phi(q)\cdot \phi(k)$。</p>
<p>运算整理后得到：</p>
<p>$$b^1&#x3D;\frac{\phi(q^1)\sum_{i&#x3D;1}^{N}\sum_{j&#x3D;1}^{N}k_1^jv^j}{\phi(q^1)\sum_{j&#x3D;1}^{N}(\phi(k^j))}$$</p>
<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h126825hg1j20tm0oe415.jpg" style="zoom:50%;" />

<p>可见公式中只有$\phi(q^1)$与$b_1$的下角标1有关，所以，其它部分（因为是矩阵运算分子和分母要分开存在两个不同的变量中，且不能进行约分）可以预先计算并储存在变量中，后续直接调用数值，这么做大大地减小了运算量。</p>
<p>如何理解这种运算方法(weighted sum)？template selection</p>
<p>函数$\phi()$，能使$exp(q\cdot k)\approx \phi(q)\cdot \phi(k)$，这个函数是什么？</p>
<ul>
<li>Efficient attention（<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1812.01243.pdf%EF%BC%89">https://arxiv.org/pdf/1812.01243.pdf）</a></li>
<li>Linear Transformer（<a target="_blank" rel="noopener" href="https://linear-transformers.com/%EF%BC%89">https://linear-transformers.com/）</a></li>
<li>Random Feature Attention（<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2103.02143.pdf%EF%BC%89">https://arxiv.org/pdf/2103.02143.pdf）</a></li>
<li>Performer（<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2009.14794.pdf%EF%BC%89">https://arxiv.org/pdf/2009.14794.pdf）</a></li>
</ul>
<h2 id="6-Synthesizer-Is-attention-really-required"><a href="#6-Synthesizer-Is-attention-really-required" class="headerlink" title="6 Synthesizer: Is attention really required?"></a>6 Synthesizer: Is attention really required?</h2><p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2005.00743">https://arxiv.org/abs/2005.00743</a></p>
<blockquote>
<p>The dot product self-attention is known to be central and indispensable to state-of-the-art Transformer models. But is it really required?</p>
<p>we find that (1) random alignment matrices surprisingly perform quite competitively and (2) learning attention weights from token-token (query-key) interactions is useful but not that important after all. </p>
</blockquote>
<p>Attn map不使用q, k进行dot-product出来，而直接就是network parameters。</p>
<p>Others:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2105.03824">Fnet: Mixing tokens with fourier transforms</a></li>
<li><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2105.08050">Pay Attention to MLPs</a></li>
<li><a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2105.01601.pdf">MLP-Mixer: An all-MLP Architecture for Vision</a></li>
</ul>
<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h12e0kkyuxj20vy0n2acf.jpg" style="zoom:50%;" />

<p>Ps.图中的圈圈大小代表了内存占用量。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/05/python%E8%A7%84%E8%8C%83%E4%B8%8E%E5%BB%BA%E8%AE%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="有聊人士">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="起名字已经很难了为什么还要给blog起个title">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 起名字已经很难了为什么还要给blog起个title">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/05/python%E8%A7%84%E8%8C%83%E4%B8%8E%E5%BB%BA%E8%AE%AE/" class="post-title-link" itemprop="url">python规范与建议</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-04-05 10:58:21" itemprop="dateCreated datePublished" datetime="2022-04-05T10:58:21+08:00">2022-04-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-04-06 10:08:02" itemprop="dateModified" datetime="2022-04-06T10:08:02+08:00">2022-04-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="1-pep-8代码规范"><a href="#1-pep-8代码规范" class="headerlink" title="1 pep-8代码规范"></a>1 pep-8代码规范</h4><p>doc : <a target="_blank" rel="noopener" href="https://learnku.com/docs/styleofcode/PEP_8/7084#5319d9">zh</a>; <a target="_blank" rel="noopener" href="https://peps.python.org/pep-0008/">en</a>;</p>
<h4 id="2-开源python-项目的目录结构规范"><a href="#2-开源python-项目的目录结构规范" class="headerlink" title="2 开源python 项目的目录结构规范"></a>2 开源python 项目的目录结构规范</h4><p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1175298">https://cloud.tencent.com/developer/article/1175298</a></p>
<h4 id="3-PyTorch最佳实践"><a href="#3-PyTorch最佳实践" class="headerlink" title="3  PyTorch最佳实践"></a>3  PyTorch最佳实践</h4><p><a target="_blank" rel="noopener" href="https://www.jiqizhixin.com/articles/2019-04-29-5">PyTorch最佳实践，怎样才能写出一手风格优美的代码</a> translated from <a target="_blank" rel="noopener" href="https://github.com/IgorSusmelj/pytorch-styleguide#a-pytorch-tools-best-practices--styleguide">A PyTorch Tools, best practices &amp; Styleguide</a></p>
<h5 id="1-推荐的工作流程："><a href="#1-推荐的工作流程：" class="headerlink" title="1.推荐的工作流程："></a>1.推荐的工作流程：</h5><ul>
<li><p>从 jupyter 笔记本开始</p>
</li>
<li><p>探索数据和模型</p>
</li>
<li><p>在笔记本的单元格中构建您的类&#x2F;方法</p>
</li>
<li><p>将您的代码移动到 python 脚本</p>
</li>
<li><p>在服务器上训练&#x2F;部署</p>
</li>
</ul>
<h5 id="2-python-脚本如何组织？"><a href="#2-python-脚本如何组织？" class="headerlink" title="2.python 脚本如何组织？"></a>2.python 脚本如何组织？</h5><blockquote>
<p> A best practice is to separate the final networks into a separate file (<em>networks.py</em>) and keep the layers, losses, and ops in respective files (<em>layers.py</em>, <em>losses.py</em>, <em>ops.py</em>). The finished model (composed of one or multiple networks) should be reference in a file with its name (e.g. <em>yolov3.py</em>, <em>DCGAN.py</em>)</p>
<p>The main routine, respective the train and test scripts should only import from the file having the model’s name.</p>
</blockquote>
<p>完整结构参照：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/29024978">https://zhuanlan.zhihu.com/p/29024978</a></p>
<p>一个<a target="_blank" rel="noopener" href="https://github.com/chenyuntc/pytorch-book/tree/v1.0/chapter6-%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97">示例</a>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">├── checkpoints/	<span class="comment"># 保存训练好的模型，使在异常退出后能重新恢复训练</span></span><br><span class="line">├── data/	<span class="comment"># 数据相关操作(数据预处理、dataset实现等)</span></span><br><span class="line">│   ├── __init__.py</span><br><span class="line">│   ├── dataset.py</span><br><span class="line">│   └── get_data.sh</span><br><span class="line">├── models/	<span class="comment"># 模型定义</span></span><br><span class="line">│   ├── __init__.py</span><br><span class="line">│   ├── AlexNet.py</span><br><span class="line">│   ├── BasicModule.py</span><br><span class="line">│   └── ResNet34.py</span><br><span class="line">└── utils/	<span class="comment"># 可能用到的工具函数，在本次实验中主要是封装了可视化工具</span></span><br><span class="line">│   ├── __init__.py</span><br><span class="line">│   └── visualize.py</span><br><span class="line">├── config.py	<span class="comment"># 配置文件，所有可配置的变量都集中在此，并提供默认值</span></span><br><span class="line">├── main.py	<span class="comment"># 主文件，训练和测试程序的入口，可通过不同的命令来指定不同的操作和参数</span></span><br><span class="line">├── requirements.txt	<span class="comment"># 程序依赖的第三方库</span></span><br><span class="line">├── README.md	<span class="comment"># 提供程序的必要说明</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>main.py</code>: </p>
<p>这个示例的<code>main.py</code>中包含4个函数<code>train()</code>, <code>val()</code>, <code>test()</code>, <code>help()</code>, 和<code>if __name__==&#39;__main__&#39;</code>。</p>
<p><code>if __name__==&#39;__main__&#39;</code>: 当.py文件被直接运行时，<code>if __name__ == &#39;__main__&#39;</code>之下的代码块将被运行；当.py文件以模块形式被导入时，<code>if __name__ == &#39;__main__&#39;</code>之下的代码块不被运行。<a target="_blank" rel="noopener" href="https://blog.csdn.net/yjk13703623757/article/details/77918633">link</a></p>
</li>
<li><p><code>model.py</code>：</p>
<p>一个关于网络结构的例子：<a target="_blank" rel="noopener" href="https://github.com/sooftware/conformer">https://github.com/sooftware/conformer</a></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0yr3q9mknj212g09yq4i.jpg" alt="conformer"></p>
</li>
</ul>
<ul>
<li><p><code>__init__.py</code>: 在Python工程里，当python检测到一个目录下存在__init__.py文件时，python就会把它当成一个模块(module)。</p>
<p>例如（*该例选自<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/115350758">这儿</a>*）：</p>
<p><img src="https://pic4.zhimg.com/80/v2-7100dede549e607784e21050928f381f_1440w.jpeg"></p>
<p>如上图，在<code>main.py</code>中想调用<code>arthmetic</code>文件夹中的四则运算脚本。可以：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @file __init__.py</span></span><br><span class="line"><span class="keyword">import</span> arithmetic.add.add <span class="keyword">as</span> add</span><br><span class="line"><span class="keyword">import</span> arithmetic.sub.sub <span class="keyword">as</span> sub</span><br><span class="line"><span class="keyword">import</span> arithmetic.mul.mul <span class="keyword">as</span> mul</span><br><span class="line"><span class="keyword">import</span> arithmetic.dev.dev <span class="keyword">as</span> dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># @file add.py</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>():</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>

<p>这样在<code>main.py</code>中一旦执行<code>import arthmetic</code>，就会自动执行arthmetic文件夹下的<code>__init__.py</code>。于是就能直接使用使用add、sub、mul、dev了。</p>
<p>具体实现可以关注<a target="_blank" rel="noopener" href="https://github.com/openspeech-team/openspeech">该库</a>的实现。一层套一层套的很漂亮。</p>
</li>
<li><p><code>config.py</code>：将可配置项放在这个文件中。包括：</p>
<ul>
<li>数据集参数（文件路径、batch_size等）</li>
<li>训练参数（学习率、训练epoch等）</li>
<li>模型参数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @file config.py 默认配置</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DefaultConfig</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">  batch_size = <span class="number">128</span>;</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, kwargs</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        根据字典kwargs 更新 config参数</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="comment"># 更新配置参数</span></span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> kwargs.items():</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(self, k):</span><br><span class="line">                <span class="comment"># 警告还是报错，取决于你个人的喜好</span></span><br><span class="line">                warnings.warn(<span class="string">&quot;Warning: opt has not attribut %s&quot;</span> %k)</span><br><span class="line">            <span class="built_in">setattr</span>(self, k, v)</span><br><span class="line">            </span><br><span class="line">        <span class="comment"># 打印配置信息	</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;user config:&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> self.__class__.__dict__.items():</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> k.startswith(<span class="string">&#x27;__&#x27;</span>):</span><br><span class="line">                <span class="built_in">print</span>(k, <span class="built_in">getattr</span>(self, k))</span><br><span class="line">  </span><br><span class="line"><span class="comment"># @file main.py</span></span><br><span class="line"><span class="keyword">from</span> config <span class="keyword">import</span> DefaultConfig</span><br><span class="line">opt = DefaultConfig()</span><br><span class="line">lr = opt.lr</span><br><span class="line">batch_size = opt.batch_size</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">opt = DefaultConfig()</span><br><span class="line">new_config = &#123;<span class="string">&#x27;batch_size&#x27;</span>:<span class="number">64</span>&#125;</span><br><span class="line">opt.parse(new_config)</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="3-其它注意事项"><a href="#3-其它注意事项" class="headerlink" title="3 其它注意事项"></a>3 其它注意事项</h5><ol>
<li><p><strong>在<code>nn.Module</code>的<code>forward</code>方法中避免使用 Numpy 代码</strong></p>
<p>Numpy 是在 CPU 上运行的，它比 torch 的代码运行得要慢一些。由于 torch 的开发思路与 numpy 相似，所以大多数 <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/cgi-bin/appmsg?t=media/appmsg_edit&action=edit&type=10&appmsgid=503277608&isMul=1&token=1365221216&lang=zh_CN">Numpy</a> 中的函数已经在 PyTorch 中得到了支持。</p>
</li>
<li><p><strong>将<code>DataLoade</code>从主程序的代码中分离</strong></p>
<p>载入数据的工作流程应该独立于你的主训练程序代码。PyTorch 使用「background」进程更加高效地载入数据，而不会干扰到主训练进程。</p>
</li>
<li><p><strong>不要在每一步中都记录结果</strong></p>
<p>通常而言，我们要训练我们的模型好几千步。因此，为了减小计算开销，每隔 n 步对损失和其它的计算结果进行记录就足够了。</p>
</li>
<li><p><strong>使用命令行参数</strong></p>
<p>使用命令行参数设置代码执行时使用的参数（batch 的大小、学习率等）非常方便。</p>
</li>
<li><p><strong>用<code>tensor.detach()</code></strong> 将tensor从计算图中脱离出来。</p>
<p>为了实现自动微分，PyTorch 会跟踪所有涉及张量的操作。使用此操作减少不必要的计算开销。</p>
<blockquote>
<p>返回一个新的tensor，新的tensor和原来的tensor共享数据内存，但不涉及梯度计算，即requires_grad&#x3D;False。修改其中一个tensor的值，另一个也会改变，因为是共享同一块内存，但如果对其中一个tensor执行某些内置操作，则会报错，例如resize_、resize_as_、set_、transpose_。</p>
<p><strong>tensor.clone().detach() 还是 tensor.detach().clone()</strong>?</p>
<p>两者的结果是一样的，即返回的tensor和原tensor在梯度上或者数据上没有任何关系，一般用前者。</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/148061684">https://zhuanlan.zhihu.com/p/148061684</a></p>
</blockquote>
</li>
<li><p><strong>使用<code>.item()</code>打印出标量张量</strong></p>
<p>你可以直接打印变量。然而，我们建议你使用<code>variable.detach()</code>或<code>variable.item()</code>。在早期版本的 PyTorch（&lt; 0.4）中，你必须使用<code>.data</code>访问变量中的张量值。</p>
</li>
<li><p><strong>使用<code>call</code>方法代替<code>nn.Module</code>中的<code>forward</code>方法</strong></p>
<p>这两种方式并不完全相同，正如下面的 GitHub 问题单所指出的：<a target="_blank" rel="noopener" href="https://github.com/IgorSusmelj/pytorch-styleguide/issues/3">https://github.com/IgorSusmelj/pytorch-styleguide/issues/3</a></p>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/04/%E8%B0%83%E5%8F%82%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="有聊人士">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="起名字已经很难了为什么还要给blog起个title">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 起名字已经很难了为什么还要给blog起个title">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/04/%E8%B0%83%E5%8F%82%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">Tuning Hyperparameters</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-04-04 15:24:16" itemprop="dateCreated datePublished" datetime="2022-04-04T15:24:16+08:00">2022-04-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-04-09 18:16:16" itemprop="dateModified" datetime="2022-04-09T18:16:16+08:00">2022-04-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/tricks/" itemprop="url" rel="index"><span itemprop="name">tricks</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=kyX29rUntjM">https://www.youtube.com/watch?v=kyX29rUntjM</a></p>
<p>常用的调参方法有3种:</p>
<blockquote>
<ul>
<li><strong><code>grid</code> Search</strong> – Iterate over every combination of hyperparameter values. Very effective, but can be computationally costly.</li>
<li><strong><code>random</code> Search</strong> – Select each new combination at random according to provided distributions. Surprisingly effective!</li>
<li><strong><code>bayesian</code> Search</strong> – Create a probabilistic model of metric score as a function of the hyperparameters, and choose parameters with high probability of improving the metric. Works well for small numbers of continuous parameters but scales poorly.</li>
</ul>
</blockquote>
<h2 id="1-Grid-search-vs-Random-search"><a href="#1-Grid-search-vs-Random-search" class="headerlink" title="1 Grid search vs. Random search"></a>1 Grid search vs. Random search</h2><p>Random search  $\surd$ : top k 个结果都是好的。</p>
<p> <strong>在网格内有N种配对方式，其中k种都是我们想要的方式。希望sample到K的几率大于90%，求sample次数x？</strong></p>
<p>sample到K的几率大于90% $\rightarrow$ x次后都没有sample到K的几率小于10%</p>
<p>$$(1-\frac{k}{N})^x &lt; 0.1$$</p>
<p>e.g., N &#x3D; 10 000, k &#x3D; 200</p>
<p>$$(1-\frac{200}{10 000})^x &lt; 0.1 \rightarrow x&gt;114$$</p>
<p>i.e., 需要抽样114次。</p>
<h2 id="2"><a href="#2" class="headerlink" title="2"></a>2</h2>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/04/wandb/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="有聊人士">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="起名字已经很难了为什么还要给blog起个title">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 起名字已经很难了为什么还要给blog起个title">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/04/wandb/" class="post-title-link" itemprop="url">wandb</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-04-04 12:05:46" itemprop="dateCreated datePublished" datetime="2022-04-04T12:05:46+08:00">2022-04-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-04-09 18:14:42" itemprop="dateModified" datetime="2022-04-09T18:14:42+08:00">2022-04-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/tool/" itemprop="url" rel="index"><span itemprop="name">tool</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>RELATED LINKS:</p>
<p> <a target="_blank" rel="noopener" href="https://docs.wandb.ai/v/zh-hans/">doc</a> &amp; <a target="_blank" rel="noopener" href="https://y4ung.blog.csdn.net/article/details/116735162?spm=1001.2101.3001.6650.7&utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-7.pc_relevant_default&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-7.pc_relevant_default&utm_relevant_index=12">blog</a></p>
<hr>
<h2 id="1-Quick-start"><a href="#1-Quick-start" class="headerlink" title="1 Quick start"></a>1 Quick start</h2><h4 id="1-配置安装"><a href="#1-配置安装" class="headerlink" title="1 配置安装"></a>1 配置安装</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install wandb</span><br><span class="line">wandb login	# 在你的shell命令行中或到注册页注册一个免费账号</span><br></pre></td></tr></table></figure>

<h4 id="2-使用"><a href="#2-使用" class="headerlink" title="2 使用"></a>2 使用</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> wandb</span><br><span class="line"></span><br><span class="line">wandb.init(project=<span class="string">&quot;my_project_name&quot;</span>)</span><br><span class="line"></span><br><span class="line">wandb.config.batch_size = <span class="number">32</span>  <span class="comment"># 记录超参数</span></span><br><span class="line"></span><br><span class="line">wandb.log(&#123;<span class="string">&#x27;accuracy&#x27;</span>: train_acc, <span class="string">&#x27;loss&#x27;</span>: train_loss&#125;)  <span class="comment"># 记录训练过程中的数据</span></span><br></pre></td></tr></table></figure>

<h2 id="2-Sweep"><a href="#2-Sweep" class="headerlink" title="2 Sweep"></a>2 Sweep</h2><p><a target="_blank" rel="noopener" href="https://colab.research.google.com/github/wandb/examples/blob/master/colabs/pytorch/Organizing_Hyperparameter_Sweeps_in_PyTorch_with_W%26B.ipynb#scrollTo=4O8IjLcKUxkC">colab教程</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/436385177">https://zhuanlan.zhihu.com/p/436385177</a></p>
<p>三步走：</p>
<ol>
<li><p>定义sweep：字典或者yaml文件定义：超参数<code>parameters</code>，指标<code>metric</code>和调参策略<code>method</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sweep_config = &#123;&#125;</span><br><span class="line"><span class="comment"># 超参数</span></span><br><span class="line">parameters_dict = &#123;</span><br><span class="line">  <span class="string">&#x27;optimizer&#x27;</span>:&#123;<span class="string">&#x27;values&#x27;</span>:[<span class="string">&#x27;adam&#x27;</span>,<span class="string">&#x27;sgd&#x27;</span>]&#125;,</span><br><span class="line">  <span class="string">&#x27;conv_d&#x27;</span>:&#123;<span class="string">&#x27;values&#x27;</span>:[<span class="number">128</span>,<span class="number">256</span>,<span class="number">512</span>]&#125;&#125;</span><br><span class="line">sweep_config[<span class="string">&#x27;parameters&#x27;</span>] = parameters_dict</span><br><span class="line"><span class="comment"># metric</span></span><br><span class="line">metric = &#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;loss&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;goal&#x27;</span>: <span class="string">&#x27;minimize&#x27;</span>&#125;</span><br><span class="line">sweep_config[<span class="string">&#x27;metric&#x27;</span>] = metric</span><br><span class="line"><span class="comment"># 调参策略</span></span><br><span class="line">sweep_config[<span class="string">&#x27;method&#x27;</span>] = <span class="string">&#x27;random&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>以上sweep_config：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># from pprint import pprint</span></span><br><span class="line"><span class="comment"># pprint(sweep_config)</span></span><br><span class="line"></span><br><span class="line">sweep_config = </span><br><span class="line">&#123;<span class="string">&#x27;method&#x27;</span>: <span class="string">&#x27;random&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;metric&#x27;</span>: &#123;<span class="string">&#x27;goal&#x27;</span>: <span class="string">&#x27;minimize&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;loss&#x27;</span>&#125;,</span><br><span class="line"> <span class="string">&#x27;parameters&#x27;</span>: &#123;<span class="string">&#x27;conv_d&#x27;</span>: &#123;<span class="string">&#x27;values&#x27;</span>: [<span class="number">128</span>, <span class="number">256</span>, <span class="number">512</span>]&#125;,</span><br><span class="line">                <span class="string">&#x27;optimizer&#x27;</span>: &#123;<span class="string">&#x27;values&#x27;</span>: [<span class="string">&#x27;adam&#x27;</span>, <span class="string">&#x27;sgd&#x27;</span>]&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>定义一个sweep controller管理调优过程。</p>
<ul>
<li>法1: yaml文件：<code>wandb sweep config.yaml</code></li>
<li>法2: 从字典传入：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sweep_id = wandb.sweep(</span><br><span class="line">  	sweep_config, </span><br><span class="line">  	project = <span class="string">&#x27;my_project_name&#x27;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>定义一个模型</p>
<p>注意：需要调参的参数需要从外传入。此模型只需要调参（conv_d）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Model</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, conv_d</span>):</span><br><span class="line">        <span class="built_in">super</span>(Model,self).__init__()</span><br><span class="line">        self.encoder = nn.Sequential(</span><br><span class="line">               nn.Conv1d(<span class="number">70</span>,</span><br><span class="line">                         conv_d,</span><br><span class="line">                         kernel_size=<span class="number">3</span>,</span><br><span class="line">                         stride=<span class="number">4</span>),</span><br><span class="line">               nn.ReLU(),</span><br><span class="line">               nn.Dropout(<span class="number">0.1</span>),)</span><br><span class="line">        self.fc = nn.Linear((<span class="number">80</span>, <span class="number">2</span>) </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">count_parameters</span>(<span class="params">self</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>([torch.numel(p) <span class="keyword">for</span> p <span class="keyword">in</span> self.parameters()])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, <span class="built_in">input</span></span>):</span><br><span class="line">        x = self.encoder(<span class="built_in">input</span>)</span><br><span class="line">        x = x.view(x.size(<span class="number">0</span>),-<span class="number">1</span>)</span><br><span class="line">        x = self.fc(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure>
</li>
<li><p>借助以下三个函数定义训练过程。</p>
<ul>
<li>wandb.init(config)：使用之前配置好的超参数取值字典初始化一个wandb进程。</li>
<li>wandb.config：调用储存的超参数取值范围传递给模型进行设置</li>
<li>wandb.log()：实验日志记录，传递实验过程数值至wandb</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义一个train函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">train</span>(<span class="params">config</span>):</span><br><span class="line">  <span class="keyword">with</span> wandb.init(config=config):</span><br><span class="line">    train_data = ...</span><br><span class="line">    train_loader = ...</span><br><span class="line">    x_test = ....to(device)</span><br><span class="line">    y_test = ....to(device)</span><br><span class="line">    </span><br><span class="line">    model = Model(conv_d = wandb.config.conv_d)</span><br><span class="line">    model.to(device)</span><br><span class="line">    optimizer = torch.optim.Adam(model.parameters(),lr=lr) <span class="keyword">if</span> wandb.config.optimizer == <span class="string">&#x27;adam&#x27;</span> <span class="keyword">else</span> optim.SGD(network.parameters(),lr=lr)</span><br><span class="line">    loss_func = nn.CrossEntropyLoss()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">      cumu_loss = <span class="number">0</span></span><br><span class="line">      <span class="keyword">for</span> _, (ix, iy) <span class="keyword">in</span> <span class="built_in">enumerate</span>(train_loader):</span><br><span class="line">        ix, iy = ix.to(device), iy.to(device)</span><br><span class="line">        output = model(ix)</span><br><span class="line">        </span><br><span class="line">        loss = loss_func(output,iy)</span><br><span class="line">        cumu_loss+=loss.item()</span><br><span class="line">        </span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        loss.backward()</span><br><span class="line">        optimizer.step()</span><br><span class="line">        </span><br><span class="line">        wandb.log(&#123;batch loss&#125;:loss.item)</span><br><span class="line">       wandb.log(<span class="string">&#x27;loss&#x27;</span>: cumu_loss / <span class="built_in">len</span>(train_loader))</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行</p>
<p>以下代码表示，按照sweep_id中的配置，运行train函数50次，即按超参数组合策略测试50种超参数组合。</p>
<p><code>wandb.agent(sweep_id, function=train, count=50)</code></p>
</li>
</ol>
<h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h3><ul>
<li><p>字典定义sweep_config并初始化一个sweep controller(项目)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sweep_config=&#123;&#x27;method&#x27;:...&#125;</span><br><span class="line">sweep_id = wandb.sweep(...)</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建一个训练过程函数<code>def train()</code>，在其中：</p>
<ul>
<li><code>wandb.init()</code>：初始化wandb</li>
<li><code>wandb.config.conv_d</code>：调用配置将原代码中需要调参的部分替换。</li>
<li><code>wandb.log(&#123;...:...&#125;)</code>：记录下需要记录的指标，例如 loss。</li>
</ul>
</li>
<li><p>运行wandb代理训练</p>
<p><code>wandb.agent(sweep_id, function=train, count=50)</code></p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> wandb</span><br><span class="line">wandb.login()</span><br><span class="line">sweep_configuration = &#123;</span><br><span class="line">    <span class="comment">#&quot;name&quot;: &quot;my-awesome-sweep&quot;,</span></span><br><span class="line">    <span class="string">&quot;metric&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;accuracy&quot;</span>, <span class="string">&quot;goal&quot;</span>: <span class="string">&quot;maximize&quot;</span>&#125;,</span><br><span class="line">    <span class="string">&quot;method&quot;</span>: <span class="string">&quot;grid&quot;</span>,</span><br><span class="line">    <span class="string">&quot;parameters&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;b&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;values&quot;</span>: [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">sweep_id = wandb.sweep(sweep_configuration,project=<span class="string">&#x27;test&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">train</span>():</span><br><span class="line">    wandb.init()</span><br><span class="line">    x = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        x += wandb.config.b</span><br><span class="line">        wandb.log(&#123;<span class="string">&#x27;x&#x27;</span>:x&#125;)</span><br><span class="line">wandb.agent(sweep_id, function=train)</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/02/blog-and-hexo-for-mac/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="有聊人士">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="起名字已经很难了为什么还要给blog起个title">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 起名字已经很难了为什么还要给blog起个title">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/02/blog-and-hexo-for-mac/" class="post-title-link" itemprop="url">blog and hexo for mac</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-04-02 17:49:43" itemprop="dateCreated datePublished" datetime="2022-04-02T17:49:43+08:00">2022-04-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-04-09 18:14:21" itemprop="dateModified" datetime="2022-04-09T18:14:21+08:00">2022-04-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/tool/" itemprop="url" rel="index"><span itemprop="name">tool</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1-安装与配置"><a href="#1-安装与配置" class="headerlink" title="1 安装与配置"></a>1 安装与配置</h2><ol>
<li>安装并配置好 git 和 node.js </li>
<li>安装 hexo <code>sudo npm install --unsafe-perm --verbose -g hexo  </code></li>
<li>运行以下命令<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo init blog # 创建一个文件夹叫blog以保存blog</span><br><span class="line">cd blog  # 进入blog文件夹</span><br><span class="line">npm install  # 下载必要文件</span><br></pre></td></tr></table></figure></li>
<li>添加国内镜像源（optional）<br><code>npm config set registry https://registry.npm.taobao.org</code></li>
<li>利用 GitHub Pages 服务<ul>
<li>创建一个仓库“用户名.github.io”</li>
</ul>
</li>
<li>修改_config.yml文件中的deploy。（该文件在之前创建的blog文件夹中）<br>修改为：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: 创建的GitHub库中的ssh链接</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure></li>
<li>输入以下命令<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save  # 安装一个扩展</span><br><span class="line">hexo g -d  # 生成博客网页文件</span><br></pre></td></tr></table></figure>
​        基本配置完成。</li>
</ol>
<h2 id="2-日常使用"><a href="#2-日常使用" class="headerlink" title="2 日常使用"></a>2 日常使用</h2><h3 id="2-1-常用命令"><a href="#2-1-常用命令" class="headerlink" title="2.1 常用命令"></a>2.1 常用命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo g  # 生成博客网页文件 hexo generate。</span><br><span class="line">hexo s  # 本地预览博客 hexo server</span><br><span class="line">hexo d  # 上传网页文件到github hexo deploy</span><br></pre></td></tr></table></figure>
<p>具体为：</p>
<ul>
<li>新建blog：<code>hexo new [layout] &lt;title&gt;</code> e.g., <code>hexo new post &quot;article title&quot;</code></li>
<li>修改 source&#x2F;_posts 文件夹里新建的md文件”article title”</li>
<li>输入hexo g生成静态网页，输入hexo s本地预览blog的效果，输入hexo d部署到github pages上。</li>
</ul>
<h3 id="2-2-分类与打标签"><a href="#2-2-分类与打标签" class="headerlink" title="2.2 分类与打标签"></a>2.2 分类与打标签</h3><ol>
<li><p>在Front-matter中对blog进行归类和打标签</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">title: &#123;&#123; title &#125;&#125;</span><br><span class="line">permalink: &#123;&#123; title &#125;&#125;</span><br><span class="line">date: &#123;&#123; date &#125;&#125;</span><br><span class="line">tags:</span><br><span class="line">categories:</span><br></pre></td></tr></table></figure>
</li>
<li><p>插入tags和categories的按钮</p>
<p>以tag为例，同理categories。</p>
<ol>
<li><p><code>hexo new page tags</code></p>
</li>
<li><p>打开tag文件夹下的md文件设定type：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 标签</span><br><span class="line">date: 2019-04-24 15:40:24</span><br><span class="line"><span class="section">type: tags</span></span><br><span class="line"><span class="section">---</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>按照theme的guide进行，对于我换的theme NexT。有：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">menu:</span><br><span class="line">  home: / || fa fa-home</span><br><span class="line">  tags: /tags/ || fa fa-tags</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<h2 id="Other：遇见的问题"><a href="#Other：遇见的问题" class="headerlink" title="Other：遇见的问题"></a>Other：遇见的问题</h2><ol>
<li><p>deploy 成功但是页面没有更新？</p>
<p>可能是两个问题：</p>
<p>第一个：deployments没有active。解决方式是点击一下”github-pages” ，就会从变为active。</p>
<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0vr0bs5dqj20d805uq2z.jpg" style="zoom:50%;" />

<p>第二个：分支设置错误：</p>
<p>​            网上的教程一般是部署到master上去，而默认的是main分支。</p>
<p>​            解决：修改部署分支为master。</p>
<p>​            点击：settings–pages–scource修改。</p>
</li>
</ol>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://alexander-qi.github.io/2019/writingblogs/">创建流程1</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/35668237">创建流程2</a></p>
<p><a target="_blank" rel="noopener" href="https://www.githang.com/2018/12/22/hexo-new-post-path/">如何在Hexo中对文章md文件分类</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/02/%E7%BF%BB%E8%AF%91A%20Recipe%20for%20Training%20Neural%20Networks/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="有聊人士">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="起名字已经很难了为什么还要给blog起个title">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 起名字已经很难了为什么还要给blog起个title">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/02/%E7%BF%BB%E8%AF%91A%20Recipe%20for%20Training%20Neural%20Networks/" class="post-title-link" itemprop="url">翻译A Recipe for Training Neural Networks</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-04-02 15:52:14" itemprop="dateCreated datePublished" datetime="2022-04-02T15:52:14+08:00">2022-04-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-04-04 14:40:47" itemprop="dateModified" datetime="2022-04-04T14:40:47+08:00">2022-04-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/tricks/" itemprop="url" rel="index"><span itemprop="name">tricks</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>本文为对A Recipe for Training Neural Networks的翻译（非直译，有删减）。<br>来自：<a target="_blank" rel="noopener" href="http://karpathy.github.io/2019/04/25/recipe/">http://karpathy.github.io/2019/04/25/recipe/</a><br>其它：<br><a target="_blank" rel="noopener" href="https://blog.slavv.com/37-reasons-why-your-neural-network-is-not-working-4020854bd607">37 Reasons why your Neural Network is not working</a>及其<a target="_blank" rel="noopener" href="https://blog.csdn.net/hustqb/article/details/78648556">网友翻译版本</a></p>
<hr>
<p>神经网络是一个leaky abstraction。大量的API，abstraction似乎使我们不必去了解底层原理就能搭建出神经网络，但如果我们真的这样做的话，神经网络很容易就悄摸的产生许多错误。<br>本文是减少神经网课不work带来的痛苦的小棉袄。</p>
<blockquote>
<p>The qualities that in my experience correlate most strongly to success in deep learning are patience and attention to detail.</p>
</blockquote>
<hr>
<h4 id="1-与数据合二为一"><a href="#1-与数据合二为一" class="headerlink" title="1. 与数据合二为一"></a>1. 与数据合二为一</h4><p>训练神经网络前，花时间看看数据。</p>
<ol>
<li>关注数据的分布和异常值。</li>
<li>关注自己分类数据的方式。</li>
</ol>
<p>方式：编写一些简单的代码，对数据进行过滤、搜索、排序。可视化数据可以直观地发现规律和问题。</p>
<h4 id="2-建立简单的模型"><a href="#2-建立简单的模型" class="headerlink" title="2. 建立简单的模型"></a>2. 建立简单的模型</h4><p>做一个简单的小实验。用一个你认为绝对不会搞砸的简单模型建立跑通整个流程：完整的训练+完整的评估。  </p>
<p>这一步的tips：</p>
<ol>
<li>固定random seed。使实验可复现，减少随机性。</li>
<li>简单。减少不必要的花里胡哨。比如data augmentation。</li>
<li>在评估中使用重要的数据。评价时画出基于整个数据集的loss，而不是只基于batch（然后在tensorboard作平滑处理）。</li>
<li>验证以确保正确的loss初始值。</li>
<li>验证以确保正确的最后一层权重初始值。<blockquote>
<p>E.g. if you are regressing some values that have a mean of 50 then initialize the final bias to 50. If you have an imbalanced dataset of a ratio 1:10 of positives:negatives, set the bias on your logits such that your network predicts probability of 0.1 at initialization. Setting these correctly will speed up convergence and eliminate “hockey stick” loss curves where in the first few iteration your network is basically just learning the bias.<br><a target="_blank" rel="noopener" href="https://stats.stackexchange.com/questions/408811/setting-bias-of-output-layer-for-imbalanced-datasets">https://stats.stackexchange.com/questions/408811/setting-bias-of-output-layer-for-imbalanced-datasets</a></p>
</blockquote>
</li>
<li>把你自己当作baseline。评估人可以理解的指标。比如：准确率呀，预测出来的标签呀。</li>
<li>训练一个input-free模型。通常是训练时把训练数据都设置为0，看模型的输出值，通常这个评估出来的性能会比有数据输入的效果差，以此查看模型是否成功从数据中提取了有用信息。</li>
<li>过拟合一个batch。一直训练一个batch（样本数量可低至2个）直至过拟合，验证loss是可以达到0的。可以在图上可视化，直观观察真实标签和预测标签是否重合，如果没有，不能进行到下一步。</li>
<li>验证减小的training loss。扩大数据集，看你的loss有没有减小。</li>
<li>在数据进入模型前可视化数据。看看数据和标签呗。</li>
<li>动态观测预测过程。我喜欢聚焦test数据的一个batch，观测预测如何改变，有时感觉模型挣扎着要拟合你的数据，比如说有抖动。<blockquote>
<p> Very low or very high learning rates are also easily noticeable in the amount of jitter.</p>
</blockquote>
</li>
<li>使用反向传播来绘制依赖关系。<blockquote>
<p>Your deep learning code will often contain complicated, vectorized, and broadcasted operations. A relatively common bug I’ve come across a few times is that people get this wrong (e.g. they use view instead of transpose&#x2F;permute somewhere) and inadvertently mix information across the batch dimension. It is a depressing fact that your network will typically still train okay because it will learn to ignore data from the other examples. One way to debug this (and other related problems) is to set the loss to be something trivial like the sum of all outputs of example i, run the backward pass all the way to the input, and ensure that you get a non-zero gradient only on the i-th input. The same strategy can be used to e.g. ensure that your autoregressive model at time t only depends on 1..t-1. More generally, gradients give you information about what depends on what in your network, which can be useful for debugging.</p>
</blockquote>
</li>
<li>先写specific function，再把它改成generalized版本。</li>
</ol>
<h4 id="3-过拟合"><a href="#3-过拟合" class="headerlink" title="3.过拟合"></a>3.过拟合</h4><p>在这一步，我们已经对数据有了充分了解，并有了一个可以正常运行的小模型和评估架子了。这样我们可以计算得到任何我们可以信任的指标了。下一步可以训练出一个好的模型了。<br>为了找到一个好的模型，下一步是：（1）找到一个模型使它过拟合（关注training loss），（2）并且进行正则化（牺牲部分training loss以提升validation loss）。试想一下，如果无法找到任何一个模型达到一个低错误率，这说明之前有些问题。</p>
<p>过拟合这一步的tips：</p>
<ul>
<li><p>挑选模型。尤其在早期，不要搞些花里胡哨的。我总是建议人们找到最相关的文章直接复制他们最简单的结构，以获得良好的性能。</p>
<ul>
<li>adam是最安全的。训练早期强推Adam with a learning rate of [3e-4]。Adam对超参数很能忍，即使学习率真的很烂。例如，对ConvNets而言，一个精心调整的SGD总是比Adam的效果要好一些，但理想学习率区间却要窄，而且是针对特定问题的。（注意：If you are using RNNs and related sequence models it is more common to use Adam.）</li>
<li>一次只把一个地方搞复杂。每次一个plug-in，并确保有你预期的性能提升。</li>
<li>别相信默认的learning rate decay。注意学习率的衰减，尤其当从其它领域搞过来代码时。如果你不是太小心的话，你的学习率会由于不好的衰减率，可能太早就衰减到0。通常，I always disable learning rate decays entirely (I use a constant LR) and tune this all the way at the very end.</li>
</ul>
<blockquote>
<p>Not only would you want to use different decay schedules for different problems, but - even worse - in a typical implementation the schedule will be based current epoch number, which can vary widely simply depending on the size of your dataset.</p>
</blockquote>
</li>
</ul>
<h4 id="4-正则化"><a href="#4-正则化" class="headerlink" title="4.正则化"></a>4.正则化</h4><p>理想情况下，我们已经拥有了一个至少适配数据集的大模型了。是时候进行正则化，并通过牺牲一些training acc以换取validation acc了。</p>
<p>正则化这一步的tips：</p>
<ul>
<li>更多数据。一个配置良好的网络需要更多数据。另一个提升性能的方法是ensembles（如果你可以承受），但最多5个模型就到顶了。</li>
</ul>
<ul>
<li><p>data augment。积极尝试半假数据。</p>
</li>
<li><p>creative augmentation。如果上面那种半假数据没用的话，不如直接尝试假数据。</p>
<blockquote>
<p>For example, <a target="_blank" rel="noopener" href="https://openai.com/blog/learning-dexterity/">domain randomization</a>, use of <a target="_blank" rel="noopener" href="http://vladlen.info/publications/playing-data-ground-truth-computer-games/">simulation</a>, clever <a target="_blank" rel="noopener" href="https://arxiv.org/abs/1708.01642">hybrids</a> such as inserting (potentially simulated) data into scenes, or even GANs.</p>
</blockquote>
</li>
</ul>
<ul>
<li>预训练模型：即使你有足够多的数据，使用预训练模型也会丝滑很多。</li>
</ul>
<ul>
<li><p>我劝你坚持监督学习。目前没有在机器视觉这一块儿看到无监督训练特别牛逼。</p>
</li>
<li><p>减小输入的维度。删除那些含有杂散信息的特征。如果你的数据集特别小，这些spurious signal只会增加你过拟合的机会。</p>
</li>
<li><p>减小模型大小。很多情况下，可以用领域知识减小模型的大小。</p>
<blockquote>
<p>As an example, it used to be trendy to use Fully Connected layers at the top of backbones for ImageNet but these have since been replaced with simple average pooling, eliminating a ton of parameters in the process.</p>
</blockquote>
</li>
<li><p>减小batch大小。由于batch norm，较小的batch大小在某种程度上对应于更强的正则化。</p>
<blockquote>
<p>Due to the normalization inside batch norm smaller batch sizes somewhat correspond to stronger regularization. This is because the batch empirical mean&#x2F;std are more approximate versions of the full mean&#x2F;std so the scale &amp; offset “wiggles” your batch around more.</p>
</blockquote>
</li>
<li><p>加入dropout。小心使用，因为<a target="_blank" rel="noopener" href="https://arxiv.org/abs/1801.05134">dropout和batch norm好像不太搭</a>。</p>
</li>
<li><p>权重衰减。增加权重衰减的惩罚。</p>
</li>
<li><p>及时停止：基于你的验证数据，在过拟合前停止。</p>
</li>
<li><p>尝试大一点的模型：性能更佳哟。</p>
</li>
</ul>
<p>最后，为了确认这个模型是一个合理的分类器，我喜欢可视化网络的第一层的权重。确保这些权重有良好的边缘，如果它们看起来像是噪点，那么可能出现问题了。同样的，activation也能反映问题哟。</p>
<h4 id="5-调参"><a href="#5-调参" class="headerlink" title="5.调参"></a>5.调参</h4><p>调参的tips：</p>
<ul>
<li>随机搜索而不是网格搜索。使用grid search一次性调整多个参数的注意很不错，但记得坚持随机搜索。这是因为神经网络对一些参数远比另一些更敏感，不如对更重要的参数多采一些样吧。</li>
<li>超参数优化。使用花哨的bayesian hyper-parameter optimization toolboxes吧，或者更好地是使用实习生（狗头）。</li>
</ul>
<h4 id="6-压榨最后一滴性能"><a href="#6-压榨最后一滴性能" class="headerlink" title="6.压榨最后一滴性能"></a>6.压榨最后一滴性能</h4><p>除了最好的结构和最好的超参数，你还可以：</p>
<ul>
<li>ensembles：模型集成可以保证2%的性能提升。如果你的算力到达了极限，可以尝试 <a target="_blank" rel="noopener" href="https://arxiv.org/abs/1503.02531">dark knowledge</a>来将你的ensemble处理成一个网咯。</li>
<li>让它跑着吧。说不定跑久了就是sota了。</li>
</ul>
<p>读到这儿，你已经知道了成功所需的所有ingredients了，没错，我说的是：对技术的深刻理解，数据集和提出的问题，你设置了一整个训练&#x2F;评估结构，并对它计算出的acc有十足的信心，接着你开发了更加复杂的模型，在你改动的每一步都有性能的提升。我想，你已经准备大量打量文章，做大量实验，并得到你的sota结果了。</p>
<blockquote>
<p>Good Luck!</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">此人类超勇</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
